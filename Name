SELECT ID,
       LISTAGG(COALESCE(GivenName1, '') || ' ' || COALESCE(GivenName2, '') || ' ' || COALESCE(GivenName3, '') || ' ' || LastName || ' (' || NameUsageType || ')', ', ') 
       WITHIN GROUP (ORDER BY NameUsageType) AS FullNameDetails
FROM IndividualNames
GROUP BY ID;


SELECT ID,
       LISTAGG(COALESCE(GivenName1, '') || ' ' || COALESCE(GivenName2, '') || ' ' || COALESCE(GivenName3, '') || ' ' || LastName || ' (' || NameUsageType || ')', ', ') 
       WITHIN GROUP (ORDER BY NameUsageType) AS FullNameDetails
FROM IndividualNames
WHERE NameUsageType IN ('Legal Name', 'Preferred Name') -- Specify the desired usage types
GROUP BY ID;

SELECT ID,
       COALESCE(GivenName1, '') || ' ' || COALESCE(GivenName2, '') || ' ' || COALESCE(GivenName3, '') || ' ' || LastName || ' (Legal Name)' AS FullNameDetails
FROM IndividualNames
WHERE NameUsageType = 'Legal Name';


WITH ConcatenatedNames AS (
    SELECT ID,
           COALESCE(GivenName1, '') || ' ' || 
           COALESCE(GivenName2, '') || ' ' || 
           COALESCE(GivenName3, '') || ' ' || 
           LastName AS FullName
    FROM IndividualNames
)
SELECT DISTINCT a.ID AS PartyID1, b.ID AS PartyID2, a.FullName
FROM ConcatenatedNames a
JOIN ConcatenatedNames b 
  ON a.FullName = b.FullName
  AND a.ID < b.ID;
